angular.module("starter.directives",[]).directive("bonusFull",["bonusTrendServices","$rootScope",function(e,t){return{restrict:"AE",transclude:!0,replace:!0,scope:{signCache:"=",sign:"@",issueList:"="},template:'<div><div class="column-body"><div style="width:60px"><section></section></div><div class="column-left-other cont"><section class="column-scroll-x" chart-client-width></section></div></div></div>',link:function(t,i,n){function o(i){var n,o,c=t.issueList;c.length&&(i?(m.innerHTML="",c=e.issueData[i]):(n=l(c),f.appendChild(n)),o=a(c,t.sign),m.appendChild(o))}function l(e){function t(e,t,o,l,a){l%2&&(e.beginPath(),e.fillStyle="#f4f4f4",e.fillRect(0,l*n,i,n),e.closePath()),e.beginPath(),e.lineWidth=1,e.strokeStyle="#ddd",e.moveTo(0,l*o+o),e.lineTo(t,l*o+o),e.lineTo(t,l*o),e.stroke(),e.beginPath(),e.font="24px Arial",e.fillStyle="#666",e.textAlign="center",e.textBaseline="middle",e.fillText(a,t/2,l*o+o/2)}var i=120,n=68,o=i,l=n*e.length,a=document.createElement("canvas");if(a.width=o,a.height=l,a.getContext){var c=a.getContext("2d");return e.forEach(function(e,o){t(c,i,n,o,e.issue)}),a.style.width=o/2+"px",a.style.height=l/2+"px",a}}function a(e,t){function i(e,i,l,a,c,s,r){a%2&&(e.beginPath(),e.fillStyle="#f4f4f4",e.fillRect(c*n,a*o,n,o),e.closePath()),0==s?(s="red"==t||"blue"==t?c+1:c,e.beginPath(),e.fillStyle=r,e.arc(c*i+i/2,a*l+l/2,l/2-10,0,2*Math.PI),e.fill(),e.fillStyle="#fff"):e.fillStyle="#666",e.beginPath(),e.lineWidth=1,e.strokeStyle="#ddd",e.moveTo(c*i,a*l),e.lineTo(c*i,a*l+l),e.lineTo(c*i+i,a*l+l),e.stroke(),e.beginPath(),e.font="24px Arial",e.textAlign="center",e.textBaseline="middle",e.fillText(s,c*i+i/2,a*l+l/2)}var n=60,o=68,l=document.documentElement.clientWidth-60,a=e[0].yiLou[t].length;l>30*a&&(n=l/a*2);var c=document.createElement("canvas"),s=e.length*o,r=a*n,u="blue"==t?"#167CE8":"#ff3939";if(c.width=r,c.height=s,c.getContext){var d=c.getContext("2d");return e.forEach(function(e,l){e.yiLou[t].forEach(function(e,t){i(d,n,o,l,t,e,u)})}),c.style.width=r/2+"px",c.style.height=s/2+"px",c}}var c,s,r,u,d;r=i.find("section")[1],c=document.documentElement.clientHeight,s=document.documentElement.clientWidth,r.onscroll=function(e){d=i[0].parentNode.querySelector("section"),u=e.target.scrollLeft,d&&(d.style.webkitTransform="translate3d("+-u+"px, 0, 0)",d.style.transform="translate3d("+-u+"px, 0, 0)")};var f=i.find("section")[0],m=i.find("section")[1],h=0;t.$watch("sign",function(e,i){h+=1,h>1&&e.indexOf("def")>-1&&o(t.signCache)}),t.$watch("issueList",function(e,t){e&&o()})}}}]).directive("showMore",["bonusTrendServices","$stateParams",function(e,t){return{restrict:"AE",transclude:!0,replace:!0,scope:{pickerVal:"=",signArr:"=",index:"=",isFull:"="},templateUrl:"miss.html",link:function(i,n,o){function l(e){c=angular.isArray(i.signArr[i.index])?i.signArr[i.index][i.pickerVal]:i.signArr[i.index],i.totalSum=e.totalSum[c]||e.totalSum.def&&e.totalSum.def.slice(10*i.index,i.signArr[i.index]+10*i.index),i.avgYiLou=e.avgYiLou[c]||e.totalSum.def&&e.avgYiLou.def.slice(10*i.index,i.signArr[i.index]+10*i.index),i.maxYiLou=e.maxYiLou[c]||e.totalSum.def&&e.maxYiLou.def.slice(10*i.index,i.signArr[i.index]+10*i.index),i.maxLianChu=e.maxLianChu[c]||e.totalSum.def&&e.maxLianChu.def.slice(10*i.index,i.signArr[i.index]+10*i.index)}var a,c,s=!0;i.bBtn=!1,i.promptTitle="查看历史统计",i.totalSum=[],i.avgYiLou=[],i.maxYilou=[],i.maxLianChu=[],i.winW=document.documentElement.clientWidth,i.showSum=function(){i.bBtn=!i.bBtn,i.bBtn?(n.css("height","180px"),i.promptTitle="收起历史统计",s?(s=!1,setTimeout(function(){e.chartSum(t.id).then(function(e){a=e,l(a)})},100)):l(a)):(n.css("height","44px"),i.promptTitle="查看历史统计")},i.$on("hideMore",function(){n.css("height","44px"),i.promptTitle="查看历史数据",i.bBtn=!1})}}}]).directive("chartHeight",function(){return{restrict:"AE",link:function(e,t,i){winW=document.documentElement.clientWidth,t.css({height:document.documentElement.clientHeight-160+"px"})}}}).directive("chartClientWidth",function(){return{restrict:"AE",link:function(e,t,i){winW=document.documentElement.clientWidth,t.css({width:winW-60+"px"})}}}).directive("issue",function(){return{restrict:"AE",replace:!0,scope:{issueData:"="},template:'<div class="bonus-row"><div class="bonus-col bg-fdd9d9" ng-repeat="number in issueData track by $index" style="width:{{width}}px"><span >{{number}}</span></div></div>',link:function(e,t,i){var n=document.documentElement.clientWidth-60,o=e.issueData.length;e.width=30,n>e.width*o&&(e.width=n/o)}}}).directive("showGroup",["bonusTrendServices",function(e){return{restrict:"AE",scope:{sign:"@"},template:'<div class="group-more" ><h3 class="group-header" on-tap="showLayer()">{{playName}}<i class="icon icon-down-more" ng-class="{\'direction-up\': isUp}"></i></h3><div class="group-title-list"><div><em  on-tap="selectHandle()" ng-class="{active: playName == \'组合\'}">全部组合</em></div><div ng-repeat="groups in cacheData track by groups.playName"><em  on-tap="selectHandle(groups.playName)" ng-class="{active: \'\' + groups.playName == playName}">{{groups.playName}}</em></div></div></div>',link:function(t,i,n){function o(e){l.style.transform="translate3d(0, "+e+"px, 0)",l.style.webkitTransform="translate3d(0, "+e+"px, 0)"}var l=i.find("div")[0].querySelector(".group-title-list"),a=[];t.cacheData=e.issueDataHandle(t.sign),t.playName="组合",t.selectHandle=function(e){e?angular.forEach(t.cacheData,function(i,n){i.playName==e&&(t.playName=e,a=t.cacheData.slice(n,n+1))}):(a=t.cacheData,t.playName="组合"),o(0),document.body.scrollTop=document.documentElement.scrollTop=0,t.$emit("changeGroupData",a),t.isUp=!1},t.showLayer=function(){var e;e=t.isUp?0:-l.offsetHeight,o(e),t.isUp=!t.isUp}}}}]).directive("bonusK3",["bonusTrendServices","$rootScope",function(e,t){return{restrict:"AE",transclude:!0,replace:!0,scope:{sign:"@",issueList:"=",sumData:"="},template:"<section></section>",link:function(e,i,n){function o(e,t){var i,n=l(e,t);i=a(n,e,t),c.appendChild(i)}function l(t,i){function n(e,i){angular.isArray(l)&&(l.unshift({issue:"",yiLou:{def:"sum"==t?o.avgYiLou[t].slice(e,e+i):o.avgYiLou[t]}}),l.unshift({issue:"",yiLou:{def:"sum"==t?o.maxYiLou[t].slice(e,e+i):o.maxYiLou[t]}}))}var o=angular.copy(e.sumData),l=[];return angular.copy(e.issueList,l),i&&(t.indexOf("sum4")>-1?(angular.forEach(l,function(e){e.yiLou.sum&&(e.yiLou.def=e.yiLou.sum.slice(0,7))}),t="sum",n(0,7)):t.indexOf("sum11")>-1?(angular.forEach(l,function(e){e.yiLou.sum&&(e.yiLou.def=e.yiLou.sum.slice(7,15))}),t="sum",n(7,7)):t.indexOf("span")>-1?(angular.forEach(l,function(e){e.yiLou.span&&(e.yiLou.def=e.yiLou.span)}),n()):n()),angular.forEach(l,function(e,t){var n=e.yiLou.def;n.unshift(e.issue.substring(4)),0==t&&i?n.splice(1,0,"最大遗漏"):1==t&&i?n.splice(1,0,"平均遗漏"):n.splice(1,0,e.bonusNumber.split(",").join(" "))}),l}function a(e,t,i){function n(e,n,o,c,r,u,d){function f(e,t,i){0!=r&&1!=r||(t=120),e.beginPath(),e.fillStyle=i,r>1?e.fillRect(r*t+2*(120-t),c*l,t,l):e.fillRect(r*t,c*l,t,l)}function m(){0===u&&(v.beginPath(),v.fillStyle=d,0==r?v.arc(r*n+n/2,c*o+o/2,o/2-10,0,2*Math.PI):1==r?v.arc(r*n+n/2+(120-n),c*o+o/2,o/2-10,0,2*Math.PI):v.arc(r*n+n/2+2*(120-n),c*o+o/2,o/2-10,0,2*Math.PI),v.fill())}function h(e,t,i,n,o){e.beginPath(),e.lineWidth=1,e.strokeStyle="#ddd",0==i?(e.moveTo(i*n,t*o),e.lineTo(i*n,t*o+o),e.lineTo(i*n+n,t*o+o)):1==i?(e.moveTo(i*n+(120-n),t*o),e.lineTo(i*n+(120-n),t*o+o),e.lineTo(i*n+n+(120-n),t*o+o)):(e.moveTo(i*n+2*(120-n),t*o),e.lineTo(i*n+2*(120-n),t*o+o),e.lineTo(i*n+n+2*(120-n),t*o+o)),e.stroke()}function p(e,t,i,n,l){m();var a={};l?a=l:0==i?a.color="#fff":a.color="#666",e.beginPath(),0===i?(e.fillStyle=a.color,i=r+("span"==n?-2:"sum4"==n?2:"sum11"==n?9:-1)):e.fillStyle=a.color,e.font="24px Arial",e.textAlign="center",e.textBaseline="middle",0==r?e.fillText(i,60,c*o+o/2):1==r?e.fillText(i,180,c*o+o/2):e.fillText(i,r*t+t/2+2*(120-t),c*o+o/2)}var g,v=e.getContext("2d");g=0==c&&i?"#FCF2CE":1==c&&i?"#DFEFFF":c%2?"#f4f4f4":"#fff",f(v,n,g),1==r||0==r?(h(v,c,r,120,o),1==r&&c>1||!i&&1==r?p(v,n,u,t,{color:"#ff3939"}):p(v,n,u,t)):(h(v,c,r,n,o),p(v,n,u,t)),e.style.width=a+"px",e.style.height=s/2+"px"}var o=60,l=68,a=document.documentElement.clientWidth,c=e[0].yiLou.def.length;c<=10&&(o=(a-120)/(c-2)*2);var s=e.length*l;if(arcStyle="#ff3939",oCanvas=document.createElement("canvas"),oCanvas.width=2*a,oCanvas.height=s,oCanvas.getContext)return e.forEach(function(e,t){e.yiLou.def.forEach(function(e,i){n(oCanvas,o,l,t,i,e,arcStyle)})}),oCanvas}e.isOffLine=t.isOffLine,e.winW=document.documentElement.clientWidth;var c=i[0],s=0;e.$watch("issueList",function(t,i){s+=1,t&&o(e.sign,s<2)})}}}]).directive("scrollLoad",["bonusTrendServices","$rootScope",function(e,t){return{restrict:"AE",transclude:!0,replace:!0,template:'<div style="width: 100%"><div class="off-line" ng-if="isOffLine">网络连接失败,请检查网络!</div><div class="loading-wrap" ng-if="!isOffLine"><span class="loading" style="-webkit-transform: rotate(0deg);"></span></div></div>',link:function(e,t,i){function n(){a=document.body.scrollTop||document.documentElement.scrollTop,o=t[0].querySelector(".loading-wrap"),l&&(l=!1,setTimeout(function(){o&&c-o.getBoundingClientRect().top>s&&e.$apply(i.onInfinite),l=!0},100))}var o=null,l=!0,a=0,c=document.documentElement.clientHeight,s=i.distance||40;i.onInfinite&&(setTimeout(function(){window.onscroll=n},1e3),"false"==i.isScrollLoad&&setTimeout(function(){n()},100))}}}]);