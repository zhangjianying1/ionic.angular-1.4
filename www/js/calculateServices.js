angular.module("starter.services",[]).factory("calculateServices",["globalServices","$ionicModal","$rootScope","$q",function(e,t,a,n){return{getLastIssue:function(t){function a(e){return angular.forEach(e,function(e,t){e.value="第"+e.issue+"期开奖结果",e.active=!1}),e}var n=this;e.post(4e3,"list",{lotteryCode:t.default.lotteryCode,page:1}).then(function(u){var l=u.issueList;angular.isArray(l)&&(l[0]&&l[0].bonusNumber&&l[0].bonusNumber.search(/\d/)<0&&l.splice(0,1),e.serializeLottery(l),t.lastIssue=a(l),t.default.lotteryIssue=t.lastIssue[0].value,t.default.lotteryName=l[0].lotteryName,n.lotteryNumberHandle("calculate",l))})},lotteryNumberHandle:function(t,a){var n,u=[];return angular.isUndefined(a)?(n=e.cache("calculate"),u=[],angular.forEach(n,function(e){e.value==t&&(u=e.bonusNumber)}),u):void e.cache("calculate",a)},bBtn:!0,calculateHandle:function(t,a){var n=this;n.bBtn&&(n.bBtn=!1,e.serialPost(4e3,"calc",t).then(function(e){n.showCalculateResult(e,a)},function(e){n.bBtn=!0}))},showCalculateResult:function(e,a){function n(e){var t=e.split("#");return[t[0].split(",").join(" "),t[1].split(",").join(" ")]}var u=this;e.bonusNumber=n(e.bonusNumber),e.number=n(e.number),a.data=e,a.popover?(a.popover.show(),u.bBtn=!0):t.fromTemplateUrl("./templates/calculate/calculateresult.html?d",{scope:a,animation:"slide-in-up"}).then(function(e){a.popover=e,e.show(),u.bBtn=!0}),a.closePopover=function(){a.popover.hide()}}}}]);