angular.module("starter.controllers",[]).controller("ProgrammeCtrl",["$scope","globalServices","programmeServices",function(o,e,r){o.programmes=[],o.isMore=!0,o.loadMore=function(e){r.programme(o,e)},o.doRefresh=function(){o.loadMore(1)}}]).controller("ProgrammeDetailCtrl",["$scope","globalServices","programmeServices","$stateParams","$ionicPopup","$state",function(o,e,r,a,t,n){var m=o.programme=r.getProgramme(a.programmeCode);o.programme.couponAmount=a.couponAmount,o.programme.payCount=o.programme.rewardAmount-o.programme.couponAmount<0?0:o.programme.rewardAmount-o.programme.couponAmount,r.getAccountBalance(m.lotteryCode,m.rewardAmount,o),o.buySubmit=function(e){e?n.go("tab.programmerecharge",{backURL:""}):r.buyProgramme(o,m.programCode,m.rewardAmount,a.couponCode,a.couponAmount)}}]).controller("UseCouponCtrl",["$scope","globalServices","programmeServices","$stateParams","$state",function(o,e,r,a,t){o.default={index:0,lotteryCode:a.lotteryCode,amount:a.rewardAmount},o.couponData={};var n,m,c=o.noUse={page:0,data:[],isMore:!0,flag:0},u=o.used={page:0,data:[],isMore:!0,flag:1};o.loadNoUse=function(e,a){r.getCoupon(o,"noUse",e,a)},o.doRefreshNoUse=function(){o.loadNoUse(1,function(){o.$broadcast("refreshComplete")})},o.loadUsed=function(e,a){r.getCoupon(o,"used",e,a)},o.doRefreshUsed=function(){o.loadUsed(1,function(){o.$broadcast("refreshComplete")})},o.$watch("default.index",function(e,r){if(e!=r)switch(e){case 0:c.page||o.loadNoUse();break;case 1:u.page||o.loadUsed()}}),o.selectCoupon=function(e,r){angular.forEach(o.noUse.data,function(o){o.couponId==e?o.active=!0:o.active=!1}),n=e,m=r},o.useCoupon=function(){t.go("tab.programmedetail",{programmeCode:a.programmeCode,couponCode:n,couponAmount:m})}}]).controller("ProgrammeOrderCtrl",["$scope","programmeServices","$stateParams",function(o,e,r){e.getOrderDetail(o,r.orderCode)}]);